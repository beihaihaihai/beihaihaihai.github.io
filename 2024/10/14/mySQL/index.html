<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL学习 | 北海の小站</title><meta name="author" content="BE1ha1"><meta name="copyright" content="BE1ha1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="安装mySQL可以安装到任意的盘符，安装包括连接到mySQL服务器，在工作台创建项目 安装教程 mySQL笔记是按照下面的教程学习后整理的，接下来就是整理部分了。 学习教程 选择语句USE：用来选择数据库 select：用来在数据库中查找 from：搭配在select后，选择数据库中的table where：指定table中的某些元素，例如customers_id &#x3D; 1，搜索id为1的 orde">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL学习">
<meta property="og:url" content="https://www.beihaihaihai.top/2024/10/14/mySQL/index.html">
<meta property="og:site_name" content="北海の小站">
<meta property="og:description" content="安装mySQL可以安装到任意的盘符，安装包括连接到mySQL服务器，在工作台创建项目 安装教程 mySQL笔记是按照下面的教程学习后整理的，接下来就是整理部分了。 学习教程 选择语句USE：用来选择数据库 select：用来在数据库中查找 from：搭配在select后，选择数据库中的table where：指定table中的某些元素，例如customers_id &#x3D; 1，搜索id为1的 orde">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://my-own-pic-bed.pages.dev/img/10.png">
<meta property="article:published_time" content="2024-10-14T13:51:00.000Z">
<meta property="article:modified_time" content="2024-11-06T02:10:07.581Z">
<meta property="article:author" content="BE1ha1">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://my-own-pic-bed.pages.dev/img/10.png"><link rel="shortcut icon" href="/img/tubiao.jpg"><link rel="canonical" href="https://www.beihaihaihai.top/2024/10/14/mySQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-06 10:10:07'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/xiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-video"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://my-own-pic-bed.pages.dev/img/10.png')"><nav id="nav"><span id="blog-info"><a href="/" title="北海の小站"><span class="site-name">北海の小站</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-video"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-14T13:51:00.000Z" title="发表于 2024-10-14 21:51:00">2024-10-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-06T02:10:07.581Z" title="更新于 2024-11-06 10:10:07">2024-11-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="安装mySQL"><a href="#安装mySQL" class="headerlink" title="安装mySQL"></a>安装mySQL</h2><p>可以安装到任意的盘符，安装包括连接到mySQL服务器，在工作台创建项目</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1jcabemEr7/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bdd8551641c485c305190c0dc5e3875e">安装教程</a></p>
<h2 id="mySQL"><a href="#mySQL" class="headerlink" title="mySQL"></a>mySQL</h2><p>笔记是按照下面的教程学习后整理的，接下来就是整理部分了。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1UE41147KC?p=7&amp;vd_source=bdd8551641c485c305190c0dc5e3875e">学习教程</a></p>
<h3 id="选择语句"><a href="#选择语句" class="headerlink" title="选择语句"></a>选择语句</h3><p><code>USE</code>：用来选择数据库</p>
<p><code>select</code>：用来在数据库中查找</p>
<p><code>from</code>：搭配在select后，选择数据库中的table</p>
<p><code>where</code>：指定table中的某些元素，例如customers_id = 1，搜索id为1的</p>
<p><code>order by</code>：根据某列元素排序。</p>
<h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>在select中可以输出运算后的数据，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT points, points + 10;</span><br></pre></td></tr></table></figure>
<p>同时输出points这列和每个数据运算后的新的列</p>
<p><code>AS</code>：列后面接as能给新列命名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT points + 10 AS &#x27;new column&#x27;</span><br></pre></td></tr></table></figure>
<p><code>distinct</code>： select后面接distinct可以删除列显示数据的重复性，例如address中存在两个shenzhen，运行后address列中只会存在一个shenzhen。</p>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>where语句筛选数据，后面接筛选条件，例如points &gt; 4000等。</p>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p>where语句后的条件可以用与或非运算（AND，OR，NOT），类似python语法。</p>
<p>注意：AND优先级大于OR。</p>
<h4 id="IN运算符"><a href="#IN运算符" class="headerlink" title="IN运算符"></a>IN运算符</h4><p>获取与某个列表内相匹配的数据，例如我想获得shenzhen，guangzhou和shanwei的用户数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE address IN (&#x27;shenzhen&#x27;, &#x27;guangzhou&#x27;, &#x27;shanwei&#x27;);</span><br></pre></td></tr></table></figure>
<p>IN前面可以加NOT运算符</p>
<h4 id="between运算符"><a href="#between运算符" class="headerlink" title="between运算符"></a>between运算符</h4><p>获取某个范围的数据，比如我想获得points值介于1000到3000之间，包括临界值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE points BETWEEN 1000 AND 3000</span><br></pre></td></tr></table></figure>
<p>字符串也适用，比如获取1990-01-01和2000-01-01之间的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE points BETWEEN &#x27;1990-01-01&#x27; AND &#x27;2000-01-01&#x27; </span><br></pre></td></tr></table></figure>
<h4 id="LIKE运算符"><a href="#LIKE运算符" class="headerlink" title="LIKE运算符"></a>LIKE运算符</h4><p>like运算符用来匹配字符串，有点像正则，例如我想查找B开头的用户（不区分大小写）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE name LIKE &#x27;B%&#x27;</span><br></pre></td></tr></table></figure>
<p><code>%</code>可以用来代替任意长度的任意字符，<code>_</code>相当于一个占位符，匹配任意一个字符，比如我想匹配Bob，则有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE name LIKE &#x27;B__&#x27;</span><br></pre></td></tr></table></figure>
<p>同时，这个式子也能匹配Buy之类的单词。</p>
<h4 id="regexp运算符"><a href="#regexp运算符" class="headerlink" title="regexp运算符"></a>regexp运算符</h4><p>REGEXP运算符也是用来匹配字符串的运算符，更接近正则表达式，例如想要搜索名字里有some的用户时，我们用LIKE运算符，需要：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE name LIKE &#x27;%some%&#x27;</span><br></pre></td></tr></table></figure>
<p>而用REGEXP运算符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE name REGEXP &#x27;some&#x27;</span><br></pre></td></tr></table></figure>
<p>同时，类似于正则，<code>^</code>代表匹配开头，<code>$</code>代表匹配结尾，<code>|</code>是或，<code>[]</code>内可以写一个匹配范围，[abc]代表匹配abc中的任意一个字符，也可以写成a-c，这里与正则表达式相同。</p>
<h4 id="IS-NULL运算符"><a href="#IS-NULL运算符" class="headerlink" title="IS NULL运算符"></a>IS NULL运算符</h4><p>查找某个某列数据缺失的用户（一行数据），例如，id为5号的数据缺少phone，我们只需：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE phone IS NULL </span><br></pre></td></tr></table></figure>
<p>同样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE phone IS NOT NULL </span><br></pre></td></tr></table></figure>
<p>则可以查找所有有电话号码的用户</p>
<h4 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h4><p>在关系型数据库中，每个表格都有一个主键列，这一列中的值要能够唯一识别表里的记录（唯一性）。</p>
<p>表格会默认按照主键列进行排序。</p>
<p>用order by加上列表头改变排序的列，默认升序排序，列后加上desc代表降序排序</p>
<p>可以同时排序多个列，且有先后顺序，先出现的先排，后出现的后排，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY address, name</span><br><span class="line">-- 1 shenzhen li</span><br><span class="line">-- 2 shenzhen Wang</span><br><span class="line">-- 3 guangzhou liu</span><br></pre></td></tr></table></figure>
<p>将会排序成：3 1 2，先排shenzhen和guangzhou，guangzhou在前，后排名字。</p>
<h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>限制输出前n位数据，例如我想输出前三位数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>
<p>还可以设置偏移量（offset），例如我想输出7到9位的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT 6, 9</span><br></pre></td></tr></table></figure>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><h4 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h4><p>当我们需要合并两张表的数据时：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM orders</span><br><span class="line">JOIN customers ON orders.customer_id = customers.customer_id</span><br></pre></td></tr></table></figure>
<p>同时，确保两张表中的顾客id能够对的上。</p>
<h4 id="隐式转化"><a href="#隐式转化" class="headerlink" title="隐式转化"></a>隐式转化</h4><p>隐式给表头添加别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order o </span><br></pre></td></tr></table></figure>
<p>相当于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order as o</span><br></pre></td></tr></table></figure>
<h4 id="跨数据库连接"><a href="#跨数据库连接" class="headerlink" title="跨数据库连接"></a>跨数据库连接</h4><p>只需要给不在当前数据库的表添加前缀即可，例如，我选中数据库sql_store，然后连接其他数据库sql_inventory</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM order_items oi</span><br><span class="line">JOIN sql_inventory.products p</span><br><span class="line">	ON oi.product_id = p.product_id</span><br></pre></td></tr></table></figure>
<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>假如有这么一张学生数据的表格，每栏新生数据中都有自己的导生的学号，要如何提取出新生的名字和对应导生的名字呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT n.student_id, n.name, o.name as manager</span><br><span class="line">FROM students n</span><br><span class="line">JOIN students o</span><br><span class="line">	ON n.manager_id = o.student_id</span><br></pre></td></tr></table></figure>
<p>分别给新生和老生取别名，这是就是自连接。</p>
<h4 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h4><p>可以多次使用JOIN方法。</p>
<p>练习：整合sql_invoicing中的付款数据，付款人和付款方式，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use sql_invoicing;</span><br><span class="line"></span><br><span class="line">select p.date ,p.invoice_id, c.name, p.amount, pm.name as payment_method</span><br><span class="line">FROM payments p</span><br><span class="line">JOIN payment_methods pm</span><br><span class="line">	ON p.payment_method = pm.payment_method_id</span><br><span class="line">JOIN clients c</span><br><span class="line">	ON c.client_id = p.client_id</span><br></pre></td></tr></table></figure>
<h4 id="复合连接条件"><a href="#复合连接条件" class="headerlink" title="复合连接条件"></a>复合连接条件</h4><p>用多个条件共同识别唯一数据。用于有复合主键的表格。</p>
<p>例如，order_items是一个有复合主键的表格，存在order_id 和 product_id两个主键。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use sql_store</span><br><span class="line"></span><br><span class="line">select *</span><br><span class="line">From order_items oi</span><br><span class="line">Join order_item_notes oin</span><br><span class="line">	ON oi.order_id = oin.order_id</span><br><span class="line">	AND oi.product_id = oin.product_id</span><br></pre></td></tr></table></figure>
<h4 id="隐式连接"><a href="#隐式连接" class="headerlink" title="隐式连接"></a>隐式连接</h4><p>用where子句可以实现隐式连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where 条件语句</span><br></pre></td></tr></table></figure>
<p>相当于join…on</p>
<p>不建议使用隐式连接。</p>
<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p>外连接有left join和right join。</p>
<p>当我们使用左连接时，所有左表的记录会被返回，不管条件正确与否，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from customers c</span><br><span class="line">left join orders o</span><br><span class="line">	on c.customer_id = o.customer_id</span><br></pre></td></tr></table></figure>
<p>其中customer是左表，不管有无对应id，customer中的所有用户都会出现在表中，没有数据的部分（即对应不上），用NULL填充。</p>
<p>right join右连接同理。</p>
<h4 id="多表外连接"><a href="#多表外连接" class="headerlink" title="多表外连接"></a>多表外连接</h4><p>同理多表内连接。</p>
<p>注意：当存在多表连接时，尽量避免使用右连接，统一左连接，提高代码可读性。</p>
<p>练习答案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use sql_store;</span><br><span class="line"></span><br><span class="line">select o.order_date, o.order_id, c.first_name as customer,  sh.name as shippr, os.name as status</span><br><span class="line">from orders o</span><br><span class="line">left join customers c</span><br><span class="line">	on o.customer_id = c.customer_id</span><br><span class="line">left join shippers sh</span><br><span class="line">	on o.shipper_id = sh.shipper_id</span><br><span class="line">join order_statuses as os</span><br><span class="line">	on os.order_status_id = o.status</span><br></pre></td></tr></table></figure>
<p>三表连接，其中发货人这部分实用外连接，因为可以还没发货，不存在发货人，但要保留订单信息。</p>
<h4 id="自外连接"><a href="#自外连接" class="headerlink" title="自外连接"></a>自外连接</h4><p>略。</p>
<h4 id="using子句"><a href="#using子句" class="headerlink" title="using子句"></a>using子句</h4><p>假设在join…on的语句中，on后存在两个表中的列名称是<strong>完全一样</strong>的，例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from orders o</span><br><span class="line">JOIN customers c</span><br><span class="line">	on o.customer_id = c.customer_id</span><br></pre></td></tr></table></figure>
<p>其中存在相同名称customer_id，我们可以用using子句替换，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from orders o</span><br><span class="line">join customers c</span><br><span class="line">	using (customer_id)	</span><br></pre></td></tr></table></figure>
<p>内外连接都能使用者这个子句。</p>
<p>在复合连接条件这一小节中，对于有复合主键的表格，我们也可以使用这个using子句简化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">From order_items oi</span><br><span class="line">Join order_item_notes oin</span><br><span class="line">	ON oi.order_id = oin.order_id</span><br><span class="line">	AND oi.product_id = oin.product_id</span><br><span class="line">-- 替换成：</span><br><span class="line">From order_items oi</span><br><span class="line">Join order_item_notes oin</span><br><span class="line">	using (order_id, product_id)</span><br></pre></td></tr></table></figure>
<h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>natural join，让数据库引擎直接猜测如何连接，无法外部控制。</p>
<h4 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h4><p>交叉连接得到的结果是一个表中的每行数据和另一个表中的每行数据的所有组合，例如123和abc交叉得到9种结果。</p>
<p>显式语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from ...</span><br><span class="line">cross join ...</span><br></pre></td></tr></table></figure>
<p>隐式语法，直接在from后面写两个表格的名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from first_table, second_table</span><br></pre></td></tr></table></figure>
<h4 id="联合"><a href="#联合" class="headerlink" title="联合"></a>联合</h4><p>通过union，我们可以合并多段查询的记录（行合并）。合并的查询之间的列的数量一定要一样不然会报错。</p>
<p>多段查询union中，第一段查询写了什么会被用来决定列名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select name</span><br><span class="line">from shippers</span><br><span class="line">union</span><br><span class="line">select first_name</span><br><span class="line">from customers</span><br></pre></td></tr></table></figure>
<p>如上，列名为name。</p>
<p>练习答案，根据points给用户分类型：</p>
<p>低于2000是青铜，2000到3000是白银，大于3000是黄金</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use sql_store;</span><br><span class="line"></span><br><span class="line">select customer_id, first_name, points, &#x27;Bronze&#x27; as type</span><br><span class="line">from customers c</span><br><span class="line">where c.points &lt; 2000</span><br><span class="line">union</span><br><span class="line">select customer_id, first_name, points, &#x27;Silver&#x27; as type</span><br><span class="line">from customers c</span><br><span class="line">where c.points between 2000 and 3000</span><br><span class="line">union</span><br><span class="line">select customer_id, first_name, points, &#x27;Gold&#x27; as type</span><br><span class="line">from customers c</span><br><span class="line">where c.points &gt; 3000</span><br><span class="line">order by first_name</span><br></pre></td></tr></table></figure>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>打开表格的工具栏，分析每个选项的意思：</p>
<p>PK：主键，唯一识别</p>
<p>NN：非空，代表该列不能出现NULL</p>
<p>AI：自动递增排序，通常被用在主键列，在最后一行递增添加一个id，例如现有9个数据，添加第10个数据时该数据的id默认为10。</p>
<p>Default：若你没有给某行添加该列数据，默认填充default中指定的数据，可以是NULL，也可以是0，等等。</p>
<h4 id="插入单行"><a href="#插入单行" class="headerlink" title="插入单行"></a>插入单行</h4><p>如果你要给某个数据插入新的一行，例如给customers插入新行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers</span><br><span class="line">VALUES (</span><br><span class="line">	DEFAULT,</span><br><span class="line">	&#x27;John&#x27;,</span><br><span class="line">	&#x27;Smith&#x27;</span><br><span class="line">    &#x27;1990-01-01&#x27;,</span><br><span class="line">    NULL,</span><br><span class="line">    &#x27;address&#x27;,</span><br><span class="line">    &#x27;city&#x27;,</span><br><span class="line">   	&#x27;CA&#x27;,</span><br><span class="line">    DEFAULT</span><br><span class="line">	)</span><br></pre></td></tr></table></figure>
<p>其中，DEFAULT代表添加默认值，该值参考表格工具栏中该列的Default中的值。</p>
<p>这些数据的顺序是按照列的默认顺序排列下来，一一对应的。</p>
<p>我们也可以改变他们的顺序，同时只提供Default以外的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers (</span><br><span class="line">	last_name,</span><br><span class="line">    first_name,</span><br><span class="line">    birth_day,</span><br><span class="line">    address,</span><br><span class="line">    city,</span><br><span class="line">    state</span><br><span class="line">	)</span><br><span class="line">VALUES (</span><br><span class="line">	&#x27;John&#x27;,</span><br><span class="line">	&#x27;Smith&#x27;</span><br><span class="line">    &#x27;1990-01-01&#x27;,</span><br><span class="line">    &#x27;address&#x27;,</span><br><span class="line">    &#x27;city&#x27;,</span><br><span class="line">   	&#x27;CA&#x27;,</span><br><span class="line">	)</span><br></pre></td></tr></table></figure>
<p>如此，表格的列名和填写到该列的数据一一对应，你可以以任何的顺序相照应地排列它们。</p>
<h4 id="插入多行"><a href="#插入多行" class="headerlink" title="插入多行"></a>插入多行</h4><p>非常简单，和插入单行一样，在values后面添加多个括号，一个括号代表一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO shippers (name)</span><br><span class="line">VALUES (&#x27;shipper1&#x27;),</span><br><span class="line">	   (&#x27;shipper2&#x27;),</span><br><span class="line">	   (&#x27;shipper3&#x27;)</span><br></pre></td></tr></table></figure>
<h4 id="插入分层行"><a href="#插入分层行" class="headerlink" title="插入分层行"></a>插入分层行</h4><p>假设我们有两张表格，一张表格存储订单信息，有着发货人收货人等信息，另一张表格存储订单明细，例如订购了什么产品，价格多少。两张表格是相互关联的，但我们要在订单信息表格插入一行新的数据，比如会在订单明细表格更新相对应的新数据，这时我们就要用插入多行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO orders (customer_id, order_date, status)</span><br><span class="line">VALUES (1, &#x27;2019-01-01&#x27;, 1);</span><br><span class="line"></span><br><span class="line">INSERT INTO order_items</span><br><span class="line">VALUES</span><br><span class="line">	(LAST_INSERT_ID(), 1, 1, 2.95)</span><br></pre></td></tr></table></figure>
<p>这里使用<code>LAST_INSERT_ID()</code>这个内置函数，返回最后一次插入时MySQL生成的那个id，我们就能用这个订单id来更新order_items里的订单明细，对应order里的新行。</p>
<h4 id="创建表复制"><a href="#创建表复制" class="headerlink" title="创建表复制"></a>创建表复制</h4><p>复制一张表的数据到另外一张<strong>创建的新表</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE order_archived AS</span><br><span class="line">SELECT *FROM orders</span><br></pre></td></tr></table></figure>
<p>用这个方法创建表格，不会复制主键和自动递增列的选项，单纯只是数据的copy。其中这个SELECT是CREATE语句下的一段子查询，也可以用在INSERT语句下（这里假设我们已经创建了一张新表orders_archived）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO orders_archived</span><br><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">WHERE order_date &lt; &#x27;2019-01-01&#x27;</span><br></pre></td></tr></table></figure>
<p>该例子中，复制所有order_date中日期早于2019年的数据到表orders_archived。</p>
<h4 id="更新单行"><a href="#更新单行" class="headerlink" title="更新单行"></a>更新单行</h4><p>假设要更新某个发票的支付时间和支付价格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices -- 选择表格</span><br><span class="line">SET payment_total = 10, payment_date = &#x27;date&#x27;</span><br><span class="line">where invoice_id = 1</span><br></pre></td></tr></table></figure>
<p>update…set语句默认更新整列的数据，我们这里用where加个限制条件，只更新invoice_id = 1的这一行。</p>
<h4 id="更新多行"><a href="#更新多行" class="headerlink" title="更新多行"></a>更新多行</h4><p>想要一次更新多行在MySQL workbench是不允许的（会有安全保护），可以打开设置 -&gt; MySQL Editor，拉到最下面取消勾选 <code>safe updates</code>。</p>
<p>然后就能和更新单行一样一次更新多行了，更新多少行，哪些行，取决于where条件语句的设置。</p>
<h4 id="在更新中使用子查询"><a href="#在更新中使用子查询" class="headerlink" title="在更新中使用子查询"></a>在更新中使用子查询</h4><p>select查询产生的值可以用在update中的条件语句里，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices </span><br><span class="line">SET payment_total = 10, payment_date = &#x27;date&#x27;</span><br><span class="line">where client_id = </span><br><span class="line">			(select client_id</span><br><span class="line">             FROM clients</span><br><span class="line">             WHERE name = &#x27;Myworks&#x27;)</span><br></pre></td></tr></table></figure>
<p>如此，就能找到所有名字为Myworks的用户的id，然后根据这个id来更新。</p>
<p>如果select语句中产生了多条查询记录，client_id后要用 <code>IN</code> 运算符而不是 <code>=</code>。</p>
<h4 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELECT FROM table_name</span><br></pre></td></tr></table></figure>
<p>删除名字为table_name的表格的所有数据，当然你也可以在下面使用where条件语句选择特定的行进行删除，这一切都是自由的。</p>
<h4 id="恢复数据库"><a href="#恢复数据库" class="headerlink" title="恢复数据库"></a>恢复数据库</h4><p>在这一节中修改了很多数据，可以重新执行数据库脚本来重建数据库，恢复数据库到最开始的版本。</p>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>使用这些函数可以查找或者计算某列的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MAX()</span><br><span class="line">MIN()</span><br><span class="line">AVG() -- 平均</span><br><span class="line">SUM() -- 求和</span><br><span class="line">COUNT() -- 计算记录数</span><br></pre></td></tr></table></figure>
<p>只运行非空值，如果列中有空值NULL，则不会参与计算。</p>
<p>如果你想count表格有多少行的记录，可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COUNT(*)</span><br></pre></td></tr></table></figure>
<p>同样的，这些函数后面也可以添加where选择语句， 函数后面一般用AS取个列名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	MAX(invoice_total) AS highest</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_data &gt; &#x27;2019-07-01&#x27;</span><br></pre></td></tr></table></figure>
<p>如果在COUNT记录时不想获取到重复记录，例如有多个重复的用户id，但只想记录一次，则可以用distinct关键字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COUNT(DISTINCT client_id) AS total_records</span><br></pre></td></tr></table></figure>
<h4 id="GROUP-BY子句"><a href="#GROUP-BY子句" class="headerlink" title="GROUP BY子句"></a>GROUP BY子句</h4><p>单列分组：</p>
<p>GROUP BY语句可以帮助我们给数据分组，只需要在groupby后面加上分组的依据列的名字，比如加上client_id，MySQL就会自动根据client_id分类。</p>
<p>假如我们不同的client_id对应多个订单，我们想要计算每个用户的总订单金额：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select client_id, sum(invoice_total) as total_sales</span><br><span class="line">from invoices</span><br><span class="line">where invoice_date &gt;= &#x27;2019-07-01&#x27;</span><br><span class="line">group by client_id</span><br><span class="line">order by total_sales desc</span><br></pre></td></tr></table></figure>
<p>如上，筛选并计算最后排序，语句要按照这个顺序写下来，不然会报错。</p>
<p>多列分组：</p>
<p>只要在 group by 后面加上多个列名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">	state,</span><br><span class="line">	city,</span><br><span class="line">	sum(invoice_total) as total_sales</span><br><span class="line">from invoices i</span><br><span class="line">join clients using (client_id)</span><br><span class="line">group by state, city</span><br></pre></td></tr></table></figure>
<p>先连接两表，再用州和城市来给订单总金额分组；</p>
<p>练习答案（用日期和付款方式给总付款分组）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use sql_invoicing;</span><br><span class="line"></span><br><span class="line">select p.date, pm.name as payment_method, sum(amount) as total_payments</span><br><span class="line">from payments p</span><br><span class="line">join payment_methods pm </span><br><span class="line">	ON pm.payment_method_id = p.payment_method</span><br><span class="line">group by p.date, payment_method</span><br><span class="line">order by date; </span><br></pre></td></tr></table></figure>
<h4 id="HAVING子句"><a href="#HAVING子句" class="headerlink" title="HAVING子句"></a>HAVING子句</h4><p>用having子句，我们得以在分组后进行数据筛选，比如在分组求总金额后筛选出金额大于500的组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select client_id, sum(invoice_total) as total_sales</span><br><span class="line">from invoices</span><br><span class="line">group by client_id</span><br><span class="line">having total_sales &gt; 500</span><br></pre></td></tr></table></figure>
<p>having后面也可以加复合搜索条件，用and连接即可。</p>
<p>注意：having后面用到的列名必须是select里出现过的。</p>
<h4 id="with-rollup"><a href="#with-rollup" class="headerlink" title="with rollup"></a>with rollup</h4><p>计算分组后，每一列所有数据的总和（计算聚合值），字符串等的总和会输出NULL，不是一个标准的SQL语句，仅能用于MySQL。</p>
<p>一般添加在group by语句后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select payment_method, sum(amount) as total</span><br><span class="line">-- ...(省略from等语句)</span><br><span class="line">group by payment_method with rollup</span><br></pre></td></tr></table></figure>
<p>根据支付方式分组后，rollup求total的总和作为新的一行。</p>
<h3 id="编写复杂查询"><a href="#编写复杂查询" class="headerlink" title="编写复杂查询"></a>编写复杂查询</h3><h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><p>之前介绍过，用小括号括起来的，子查询（或者叫内查询）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices </span><br><span class="line">SET payment_total = 10, payment_date = &#x27;date&#x27;</span><br><span class="line">where client_id = </span><br><span class="line">			(select client_id</span><br><span class="line">             FROM clients</span><br><span class="line">             WHERE name = &#x27;Myworks&#x27;)</span><br></pre></td></tr></table></figure>
<p>这段代码来自在更新中使用子查询这一节，其中client_id后面的语句就是一个子查询，MySQL执行时会先执行子查询。</p>
<p>练习答案（外部有IN的子查询，找到没有发票的用户）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use sql_invoicing;</span><br><span class="line"></span><br><span class="line">select *</span><br><span class="line">from clients</span><br><span class="line">where client_id NOT IN </span><br><span class="line">	(select distinct client_id</span><br><span class="line">		from invoices)</span><br></pre></td></tr></table></figure>
<h4 id="ALL关键字"><a href="#ALL关键字" class="headerlink" title="ALL关键字"></a>ALL关键字</h4><p> 子查询返回一列值时，用ALL关键字就会逐一取子查询中的值出来操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoice_total &gt; ALL(111, 222, 333);</span><br></pre></td></tr></table></figure>
<p>只有当左值大于右边的每个值时，才会时true。</p>
<h4 id="ANY关键字"><a href="#ANY关键字" class="headerlink" title="ANY关键字"></a>ANY关键字</h4><p>ANY代表任意一个，跟在子查询前代表任意一个。例如 = ANY 等价于 IN，意思是等于（子查询）里面的任意一个。</p>
<h4 id="相关子查询"><a href="#相关子查询" class="headerlink" title="相关子查询"></a>相关子查询</h4><p>子查询内存在和外查询有关联的语句。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from invoices i</span><br><span class="line">where invoice_total &gt; (</span><br><span class="line">	select avg(invoice_total)</span><br><span class="line">    from invoices</span><br><span class="line">    where client_id = i.client_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>i.client_id是外查询的值，只有当内查询的id符合外查询的id时，才会求其平均值，实际上就是根据id分组求平均值。</p>
<p>不难发现，这个相关子查询每次执行内查询都要访问一次外查询，因此运行较慢。</p>
<h4 id="EXISTS关键字"><a href="#EXISTS关键字" class="headerlink" title="EXISTS关键字"></a>EXISTS关键字</h4><p>该关键字能直接检查某个子查询中，是否有符合某个条件的行，而不会返回查询到的具体结果，对于某些返回结果较多的数据库能提高查询速度。</p>
<h4 id="select子句中的子查询"><a href="#select子句中的子查询" class="headerlink" title="select子句中的子查询"></a>select子句中的子查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">	...</span><br><span class="line">	(子查询)</span><br><span class="line">from ...</span><br></pre></td></tr></table></figure>
<h4 id="from子句中的子查询"><a href="#from子句中的子查询" class="headerlink" title="from子句中的子查询"></a>from子句中的子查询</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from(</span><br><span class="line">	...</span><br><span class="line">) AS origin</span><br></pre></td></tr></table></figure>
<p>注意：必须要取一个别名</p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><h4 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h4><p>round函数，四舍五入函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">round(5.712, 2)</span><br></pre></td></tr></table></figure>
<p>例如把5.712四舍五入，保留2位。</p>
<p>truncate函数，截断函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate(5.212, 2)</span><br></pre></td></tr></table></figure>
<p>直接截断成2位</p>
<p>ceiling函数，返回大于等于这个数的最小整数。</p>
<p>floor函数，返回小于或等于这个数的最大整数。</p>
<p>abs函数，返回绝对值。</p>
<p>rand函数，返回0-1的随机数。</p>
<h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><p>length函数，返回字符串长度，</p>
<p>upper函数，返回全大写字符串，</p>
<p>lower函数，返回全小写字符串，</p>
<p>ltrim函数，左修整，移除左边空格等预定字符，rtrim同理，trim则是前后都修整。</p>
<p>left函数，返回从左边开始前n个字符，right函数同理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">left(&#x27;string&#x27;, n)</span><br></pre></td></tr></table></figure>
<p>substring，截断函数，传入起始下标n和截断长度m，不传入长度默认到字符串结尾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substring(&#x27;string&#x27;, n, m)</span><br></pre></td></tr></table></figure>
<p>locate函数，返回查找字符的小标，不区分大小写，搜索不到返回0：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate(&#x27;s&#x27;, &#x27;string&#x27;) -- 返回1</span><br></pre></td></tr></table></figure>
<p>replace函数传入一个字符串并传入被替换的字符串和替换的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(&#x27;abc&#x27;, &#x27;ab&#x27;, &#x27;ba&#x27;) -- 返回bac</span><br></pre></td></tr></table></figure>
<p>concat函数，合并两个字符串；</p>
<h4 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h4><p>now函数，返回当前日期和时间，curdate只返回日期，curtime只返回时间；</p>
<p>extract函数，能从now函数中提取时间数据，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extract(year from now()) -- 返回当前年数</span><br></pre></td></tr></table></figure>
<p>mysql语句中还有简化的语句，直接用对应的数据英语，传入now函数就好了，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">year(now()) -- 返回当前年数</span><br></pre></td></tr></table></figure>
<h4 id="格式化日期函数"><a href="#格式化日期函数" class="headerlink" title="格式化日期函数"></a>格式化日期函数</h4><p>date_format函数，能格式化返回日期的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATE_FORMAT(now(), &#x27;%y %m %d&#x27;) -- 返回当前年月日</span><br></pre></td></tr></table></figure>
<p>除了这些格式化字母，还有其他的格式化字母，<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html">查询网址</a></p>
<p>还有time_format函数，返回格式化的时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TIME_FORMAT(now(), &#x27;%H:%i %p&#x27;) -- 12:00 PM</span><br></pre></td></tr></table></figure>
<h4 id="计算日期和时间"><a href="#计算日期和时间" class="headerlink" title="计算日期和时间"></a>计算日期和时间</h4><p>date_add函数，假如我们要增加一年：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date_sub(now(), interval -1 year)</span><br><span class="line">date_add(now(), interval 1 year)</span><br></pre></td></tr></table></figure>
<p>datediff函数，返回两日期之间的差值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">datediff(&#x27;&#x27;, &#x27;&#x27;)</span><br></pre></td></tr></table></figure>
<p>time_to_sec函数，返回从0点开始流逝的秒数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time_to_sec(&#x27;9:00&#x27;) -- 32400</span><br></pre></td></tr></table></figure>
<p>用两个time_to_sec函数的表达式相减，就能得到两时间之差了。</p>
<h4 id="IFNULL-COALESCE"><a href="#IFNULL-COALESCE" class="headerlink" title="IFNULL COALESCE"></a>IFNULL COALESCE</h4><p>ifnull函数，如果检测到某个数据是null，就用传入的字符串替换，</p>
<p>例如，顾客id是空值，则全用”未注册“替换；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFNULL(customer_id, &#x27;Not assigned&#x27;)</span><br></pre></td></tr></table></figure>
<p>coalesce函数，可以传入一堆值，返回众多值中的第一个非空值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coalesce(customer_id, comments, &#x27;Not assigned&#x27;) as cs_id</span><br></pre></td></tr></table></figure>
<p>解释：如果customer_id是null，则返回comments，若comments也是null，则返回最后的字符串（因为不是null）。</p>
<h4 id="IF表达式"><a href="#IF表达式" class="headerlink" title="IF表达式"></a>IF表达式</h4><p>传入三个参数，第一个是测试表达式，第二个是表达式为真时返回的值，第三个是表达式为假时返回的值。</p>
<h4 id="case运算符"><a href="#case运算符" class="headerlink" title="case运算符"></a>case运算符</h4><p>case运算符一般接若干个when子句，当when子句的条件成立时，执行该when子句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">case</span><br><span class="line">	when 表达式1 THEN &#x27;返回的值&#x27;</span><br><span class="line">	when ...</span><br><span class="line">	when ...</span><br><span class="line">	else &#x27; &#x27;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>最后用end闭合case语句。</p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图是把查询单独封装起来的操作，就像创建了一张<strong>虚拟的表</strong>（依赖基础表的数据），我们可以随时调用这个查询（查询的结果是一张表）语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW view_name as</span><br><span class="line">select </span><br><span class="line">	...</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<p>创建后的视图能直接调用，有点像封装好的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from view_name</span><br></pre></td></tr></table></figure>
<h4 id="删除修改视图"><a href="#删除修改视图" class="headerlink" title="删除修改视图"></a>删除修改视图</h4><p>删除视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view view_name</span><br></pre></td></tr></table></figure>
<h4 id="更改视图"><a href="#更改视图" class="headerlink" title="更改视图"></a>更改视图</h4><p>可以重新更改或者创建视图（如果该视图不存在）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace view view_name</span><br></pre></td></tr></table></figure>
<p>可以把视图放在sql文件夹中，创建git仓库方便管理。</p>
<h4 id="可更新视图"><a href="#可更新视图" class="headerlink" title="可更新视图"></a>可更新视图</h4><p>如果一个视图没有以下成分，那么它是一个可更新视图：</p>
<p>1、<code>distinct</code>关键字</p>
<p>2、聚合函数（sum，min，max等）</p>
<p>3、group by 和 having 等排序语句</p>
<p>4、<code>union</code>联合关键字；</p>
<p>如果是一个可更新视图，我们可以insert, update, delete。</p>
<p>如果需要在视图中插入新行，需要当前视图返回的表中有原来的表的全部的列，例如基础表中有日期列，视图里没有select这个列，那就没法插入新行。</p>
<h4 id="with-check-option"><a href="#with-check-option" class="headerlink" title="with check option"></a>with check option</h4><p>我们在操作可更新视图时可能会把视图中的某些行删除掉（例如某些在操作后不符合创建视图中where语句的行）。</p>
<p>为了防止这些行被意外删除，只要在创建视图的语句末尾加上<code>with check option</code>语句，当我们意外删除掉视图中的行时，会出现报错提示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WITH CHECK OPTION</span><br></pre></td></tr></table></figure>
<h3 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h3><p> 存储是一个打包SQL语句的过程，能够打包后直接调用。</p>
<h4 id="创建一个存储过程"><a href="#创建一个存储过程" class="headerlink" title="创建一个存储过程"></a>创建一个存储过程</h4><p>创建一个从begin开始到end结束的完整存储过程。</p>
<p>其中有几个要注意的点，先在一开始用<code>delimiter</code>语句修改分隔符（任意的，习惯用两个美元符号），这样就能把begin到end之间的存储看成一个整体，最后记得把默认分隔符改回分号；（后面的代码都忽略这个转变分隔符的操作，自己知道就好）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure get_client()</span><br><span class="line">begin</span><br><span class="line">	select * from clients;</span><br><span class="line">	...</span><br><span class="line">end$$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>存储不同于视图，有点像封装起来的快捷指令，封装完后可以直接调用；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL get_client()</span><br></pre></td></tr></table></figure>
<h4 id="在mysql-workbench直接创建存储"><a href="#在mysql-workbench直接创建存储" class="headerlink" title="在mysql workbench直接创建存储"></a>在mysql workbench直接创建存储</h4><p>在每个数据库中有个叫Stored Procedures的文件夹，右键创建新存储，这时候我们只需要填入mysql语句，然后会自动生成存储。</p>
<h4 id="删除存储"><a href="#删除存储" class="headerlink" title="删除存储"></a>删除存储</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists procedure_name</span><br></pre></td></tr></table></figure>
<h4 id="有传参的存储"><a href="#有传参的存储" class="headerlink" title="有传参的存储"></a>有传参的存储</h4><p>只需要在create pro语句后的存储名字的括号内添加传入的参数名字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure get_clients_by_state(state CHAR(2))</span><br><span class="line">begin</span><br><span class="line">	...</span><br><span class="line">end$$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>这里的state类型是cha(2)，代表两个字符。</p>
<h4 id="带默认值的传参"><a href="#带默认值的传参" class="headerlink" title="带默认值的传参"></a>带默认值的传参</h4><p>在存储中添加一个传参判断语句来实现默认传参，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">	if state is null then</span><br><span class="line">		set state = &#x27;cA&#x27;</span><br><span class="line">	end if;</span><br><span class="line">	...</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>以上小节的例子为基础，如果没有传参state，则这里默认set为CA，记得if语句要用end if的结束标志。</p>
<p>如果我们默认值想设置为数据库里的所有的state，巧用IFNULL可以简洁实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">	select *from clients c</span><br><span class="line">	where c.state = IFNULL(state, c.state);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>之前我们知道IFNULL语句时如果第一个参数为NULL就返回第二个参数，如果传参state为NULL，这个语句就变成c.state = c.state，自然对于clients中所有的state值都成立。</p>
<h4 id="参数验证"><a href="#参数验证" class="headerlink" title="参数验证"></a>参数验证</h4><p>当一个参数传入是非法时，我们可以通过if语句和报错设置来提醒用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if ... then</span><br><span class="line">	signal sqlstate &#x27;&#x27;</span><br><span class="line">		set MESSAGE_TEXT = &#x27;error&#x27;</span><br><span class="line">end if;</span><br></pre></td></tr></table></figure>
<p>其中signal sqlstate是设置错误码，每个错误的详细的错误码可以在官网查找：<a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/db2/10.1.0?topic=messages-sqlstate">传送门</a></p>
<h4 id="输出参数（返回值）"><a href="#输出参数（返回值）" class="headerlink" title="输出参数（返回值）"></a>输出参数（返回值）</h4><p>在传入参数前面加上OUT关键字就是输出参数，例如下面例子中的out_name：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure get_clients_by_state(state CHAR(2), OUT out_name INT)</span><br><span class="line">begin</span><br><span class="line">	...</span><br><span class="line">end$$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>可以在存储中用select…into…语句给输出参数赋值。</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>user变量，会在整个客户会话过程中被保存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @variables_name = 0</span><br></pre></td></tr></table></figure>
<p>本地变量，在存储或者函数内定义的，存储或者函数完成就会被清空：</p>
<p>使用declare关键字声明本地变量，例如，声明一个int变量默认值为0：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare variables_name INT default 0</span><br></pre></td></tr></table></figure>
<p>也可以不给本地变量设置默认值，用select … into …给变量赋值，用set语句给变量赋值。</p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>函数不同于存储只能返回单一值，没有多行和多列的结果集。</p>
<p>函数还需要声明<strong>返回值类型</strong>和<strong>函数类型</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create function func_name(client_id INT)</span><br><span class="line">returns integer -- 返回值类型声明</span><br><span class="line">-- 下面是函数类型声明</span><br><span class="line">deterministic -- 确定性的，传入值和返回值一一对应</span><br><span class="line">reads sql data -- 函数中读取了数据</span><br><span class="line">modifies sql data -- 函数中有更新插入删除等</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">	</span><br><span class="line">	return 1;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>函数类型按实际情况选择。</p>
<p>同理，你最后可以用drop删除函数。</p>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p>触发器是在插入，更新和删除语句前后自动执行的一堆sql代码，通常用来增强数据的一致性。</p>
<h4 id="新建触发器"><a href="#新建触发器" class="headerlink" title="新建触发器"></a>新建触发器</h4><p>触发器能修改别的表，但不能修改触发器所在的表。</p>
<p>新建的一个触发器在payments表，当插入新收款时，自动更新发票内某人的付款总值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create trigger payments_after_insert</span><br><span class="line">	AFTER INSERT ON payments</span><br><span class="line">	FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">	UPDATE invoices</span><br><span class="line">	SET payment_toal = payment_total + NEW.amount</span><br><span class="line">	WHERE invoice_id = NEW.invoice_id;</span><br><span class="line">END $$</span><br></pre></td></tr></table></figure>
<h4 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a>查看触发器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TRIGGERS</span><br></pre></td></tr></table></figure>
<p>用LIKE关键字能筛选存在于某个表的触发器。</p>
<h4 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER IF EXISTS trigger_name</span><br></pre></td></tr></table></figure>
<h4 id="用触发器进行审计"><a href="#用触发器进行审计" class="headerlink" title="用触发器进行审计"></a>用触发器进行审计</h4><p>新建一张审计表，触发器内编写一段代码来更新审计表，在插入删除等操作后，记录发生的操作；</p>
<p>在这个例子里，在插入触发器最后补充这段代码，能自动在审计表里更新客户id，日期，支付金额，操作类型和操作时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO payment_audit</span><br><span class="line">VALUES (</span><br><span class="line">	NEW.client_id, NEW.date, NEW.amount, &#x27;Insert&#x27;, NOW()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="事件event"><a href="#事件event" class="headerlink" title="事件event"></a>事件event</h4><p>大部分上，事件是按一定规律执行的sql代码。</p>
<p>执行事件，得先打开事件调度器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;event%&#x27;; -- 先查看是否开启</span><br><span class="line">SET GLOBAL event_scheduler = ON -- 如果查看后为OFF就执行这个</span><br></pre></td></tr></table></figure>
<p>打开事件调度器后就能开始编写事件了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create event event_name</span><br><span class="line">ON SCHEDULE </span><br><span class="line">	-- AT &#x27;2024-10-01&#x27; -- 仅在国庆节这天执行</span><br><span class="line">	EVERY 1 YEARS START &#x27;2024-01-01&#x27; ENDS &#x27;2029-01-01&#x27; -- 一年执行一次</span><br><span class="line">DO begin</span><br><span class="line">	...</span><br><span class="line">end $$</span><br></pre></td></tr></table></figure>
<h4 id="查看事件"><a href="#查看事件" class="headerlink" title="查看事件"></a>查看事件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW EVENTS;</span><br></pre></td></tr></table></figure>
<p>语法和触发器的基本一致；</p>
<h4 id="修改事件"><a href="#修改事件" class="headerlink" title="修改事件"></a>修改事件</h4><p>可以暂时启用事件或者禁用事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER EVENT event_name ENABLE;</span><br><span class="line">ALTER EVENT event_name DISABLE;</span><br></pre></td></tr></table></figure>
<h3 id="事务（搁置）"><a href="#事务（搁置）" class="headerlink" title="事务（搁置）"></a>事务（搁置）</h3><p>事务是代表单个工作单元的一组sql语句；事务是一个整体，密不可分。</p>
<h4 id="创建事务"><a href="#创建事务" class="headerlink" title="创建事务"></a>创建事务</h4><p>事务具有一致性，事务内的每个语句不会单独执行，只要有一个错误存在，整个事务都会被退回，不会出现执行了一半的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">START TRANSACTION;</span><br><span class="line">	...</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>
<p>当我们想调试这个事务时，可以把commit改成rollback，这样就会在最后退回事务并撤销所有更改；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">START TRANSACTION;</span><br><span class="line">	...</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure>
<p>补充一下，mysql先把事务里执行正确的语句自动提交（commit），由autocommit控制；查看该系统变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;autocommit&#x27;;</span><br></pre></td></tr></table></figure>
<h4 id="锁定和并发"><a href="#锁定和并发" class="headerlink" title="锁定和并发"></a>锁定和并发</h4><p>并发操作可能出现的情况：</p>
<p>当一个事务试图修改某个数据库的一行或多行时，mysql会给数据库上锁，防止其他事务同时修改这些行，出现冲突。只有当第一个事务执行完毕后第二个事务才能继续执行。</p>
<h4 id="并发问题"><a href="#并发问题" class="headerlink" title="并发问题"></a>并发问题</h4><p>脏读：读取到其他事务还未提交更改的数据；</p>
<p>重复读：重复读取的数据被其他事务修改导致不一致</p>
<p>幻读： 某个事务在执行时，其他事务修改了相关该事务的数据，导致该事务结果有误。</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h4><p>char: 定长字符串，char(10) 相当于30个字节。</p>
<p>varchar:  65535 characters</p>
<p> mediumtext：16mb</p>
<p>longtext:  4GB</p>
<hr>
<p>tinytext  ：  255 bytes</p>
<h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><p>tinyint 一个字节</p>
<p>unsigned tinyint 无符号一个字节</p>
<p>smallint  两个字节</p>
<p>mediumint 3个字节</p>
<p>int 4个字节</p>
<p>bigint 8个字节</p>
<h4 id="定点数类型"><a href="#定点数类型" class="headerlink" title="定点数类型"></a>定点数类型</h4><p>decimal(p , s)： 最多有p位，小数点后有s位，dec，numeric，fixed都是别名。</p>
<h4 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h4><p>float  4个字节</p>
<p>double 8个字节</p>
<h4 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h4><p>bool，boolean</p>
<h4 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h4><p>语法结构：enum（），括号里填入枚举的字符串，之后这一栏填写的数据只能从这里面挑选。枚举类型也许会导致各种问题，不建议使用。</p>
<h4 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h4><p>date 日期（无时间）</p>
<p>time 时间（纯时间值）</p>
<p>datetime 日期和时间（8个字节）</p>
<p>timestamp 时间戳 （4个字节）</p>
<p>year</p>
<h4 id="Blob类型"><a href="#Blob类型" class="headerlink" title="Blob类型"></a>Blob类型</h4><p>二进制长对象，用来存储各种数据。</p>
<p>不太建议把大型二进制数据存储在数据库中，会导致读取速度变慢等问题。</p>
<h4 id="JSON类型"><a href="#JSON类型" class="headerlink" title="JSON类型"></a>JSON类型</h4><p>读取json类型，用一个简短的箭头符号：</p>
<p>假如当前列proper存储的是json类型，json类型下有<code>weight: 10</code>键值对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select proper -&gt; &#x27;$.weight&#x27;</span><br></pre></td></tr></table></figure>
<p>假如键值对的值是字符串，读取出来会带有引号，修改一下箭头符号能去掉引号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select proper -&gt;&gt; &#x27;$.string&#x27;</span><br></pre></td></tr></table></figure>
<p>修改json，修改weight和string的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE database</span><br><span class="line">SET proper = JSON_SET(</span><br><span class="line">	proper,</span><br><span class="line">    &#x27;$.weight&#x27;, 20,</span><br><span class="line">    &#x27;$.string&#x27;, &#x27;sony&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>删除json，删除其中的weight和string：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UPDATE database</span><br><span class="line">SET proper = JSON_REMOVE(</span><br><span class="line">	proper,</span><br><span class="line">    &#x27;$.weight&#x27;</span><br><span class="line">    &#x27;$.string&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="设计数据库"><a href="#设计数据库" class="headerlink" title="设计数据库"></a>设计数据库</h3><h4 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h4><p>每个单元格都应该有单一值，且不能出现重复列。</p>
<h4 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h4><p>一张表仅能代表一种实体，这张表中的每一列都应该用来描述那个实体。</p>
<p>如果表中有一列描述了其他的实体，我们应该将其单独成表。</p>
<h4 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h4><p>同一表中的列不应派生自其他列。</p>
<h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists test_db;</span><br><span class="line"></span><br><span class="line">USE test_db;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS EMP;-- EMP表存在DEPT表的外键，因此EMP表要先删除。</span><br><span class="line">DROP TABLE IF EXISTS DEPT;-- 受到外键约束，不能随意删除。</span><br><span class="line"></span><br><span class="line">create table DEPT(</span><br><span class="line">	DEPTNO INT primary key,</span><br><span class="line">    DNAME VARCHAR(50) NOT NULL,</span><br><span class="line">    LOC VARCHAR(50) NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table EMP(</span><br><span class="line">	EMPNO INT primary key,</span><br><span class="line">	ENAME VARCHAR(50) NOT NULL,</span><br><span class="line">    JOB VARCHAR(50) NOT NULL,</span><br><span class="line">    MGR INT,</span><br><span class="line">    HIREDATE DATE NOT NULL,</span><br><span class="line">    SAL DECIMAL(7,2),</span><br><span class="line">    COMM INT,</span><br><span class="line">    DEPTNO INT NOT NULL,</span><br><span class="line">    FOREIGN KEY fk_EMP_DEPT (DEPTNO)</span><br><span class="line">		REFERENCES DEPT(DEPTNO)</span><br><span class="line">        ON UPDATE CASCADE</span><br><span class="line">        ON DELETE RESTRICT</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="更改数据库"><a href="#更改数据库" class="headerlink" title="更改数据库"></a>更改数据库</h4><p>把create换成alter。</p>
<h4 id="添加具体数据"><a href="#添加具体数据" class="headerlink" title="添加具体数据"></a>添加具体数据</h4><p>用INSERT语句，详见修改章节。</p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>创建能帮助我们更快找到目标；</p>
<h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><p>例如，根据state来创建索引；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_state ON customers (state);</span><br></pre></td></tr></table></figure>
<h4 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEXES IN table_name;</span><br></pre></td></tr></table></figure>
<h4 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h4><p>指定字符串列的前几个字符，用其作为区分来设定索引，例如这里取姓氏的前5个字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_state ON customers (last_name(5));</span><br></pre></td></tr></table></figure>
<h4 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h4><p>全文索引能根据查找的字符串，计算其<strong>相关性</strong>然后返回相关结果，十分灵活：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create fulltext index idx_title_body on posts(title, body);</span><br><span class="line"></span><br><span class="line">select *</span><br><span class="line">from posts</span><br><span class="line">where match(title, body) against(&#x27;react redux&#x27;)</span><br></pre></td></tr></table></figure>
<p>例子中，在每篇文章索引包含的是标题和主体；match函数中写入所有索引列，例如这里的title和body，不然mysql会报错；</p>
<p>关键是against里面的内容，react redux这两个单词用空格分割，是查找的必要条件，这两个单词可以在title和body中以任意顺序、任意形式出现，出现越多相关性越强。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">where match(title, body) against(&#x27;-from +react&#x27; in boolean mode)</span><br></pre></td></tr></table></figure>
<p>使用boolean mode，我们可以硬性查找某些字符串，例如上述例子中，查找所有包含react但没有from的行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">where match(title, body) against(&#x27;&quot;hello world&quot;&#x27; in boolean mode)</span><br></pre></td></tr></table></figure>
<p>使用双引号包含的字符串，执行语句后会返回<strong>准确包含这个字符串</strong>的行。</p>
<h4 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h4><p>mysql只会选择一个索引，我们设定多个Btree索引只会选择其中一个；</p>
<p>因此需要复合索引，复合索引可以在多列上建立索引，例如，根据顾客所在州和积分建立复合索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_state_points on customers(state, points)</span><br></pre></td></tr></table></figure>
<h4 id="复合索引中的列顺序"><a href="#复合索引中的列顺序" class="headerlink" title="复合索引中的列顺序"></a>复合索引中的列顺序</h4><p>1、把更常用的列排前面；</p>
<p>2、把基数更大的列排前面；</p>
<p>3、根据实际情况更新索引；</p>
<h3 id="实验笔记"><a href="#实验笔记" class="headerlink" title="实验笔记"></a>实验笔记</h3><p>数据库系统实验一构建数据库代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists test_db;</span><br><span class="line"></span><br><span class="line">USE test_db;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS EMP;</span><br><span class="line">DROP TABLE IF EXISTS DEPT;</span><br><span class="line"></span><br><span class="line">create table DEPT(</span><br><span class="line">	DEPTNO INT primary key,</span><br><span class="line">    DNAME VARCHAR(50) NOT NULL,</span><br><span class="line">    LOC VARCHAR(50) NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table EMP(</span><br><span class="line">	EMPNO INT primary key,</span><br><span class="line">	ENAME VARCHAR(50) NOT NULL,</span><br><span class="line">    JOB VARCHAR(50) NOT NULL,</span><br><span class="line">    MGR INT,</span><br><span class="line">    HIREDATE DATE NOT NULL,</span><br><span class="line">    SAL DECIMAL(7,2),</span><br><span class="line">    COMM INT,</span><br><span class="line">    DEPTNO INT NOT NULL,</span><br><span class="line">    FOREIGN KEY fk_EMP_DEPT (DEPTNO)</span><br><span class="line">		REFERENCES DEPT(DEPTNO)</span><br><span class="line">        ON UPDATE CASCADE</span><br><span class="line">        ON DELETE RESTRICT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO DEPT(</span><br><span class="line">	DEPTNO, DNAME, LOC</span><br><span class="line">)</span><br><span class="line">VALUES</span><br><span class="line">	(&#x27;10&#x27;, &#x27;ACCOUNTING&#x27;, &#x27;LONDON&#x27;),</span><br><span class="line">	(&#x27;20&#x27;, &#x27;RESEARCH&#x27;, &#x27;PRESTON&#x27;),</span><br><span class="line">    (&#x27;30&#x27;, &#x27;SALES&#x27;, &#x27;LIVERPOOL&#x27;),</span><br><span class="line">    (&#x27;40&#x27;, &#x27;OPERATIONS&#x27;, &#x27;STAFFORD&#x27;),</span><br><span class="line">    (&#x27;50&#x27;, &#x27;MARKETING &#x27;, &#x27;LUTON&#x27;);</span><br><span class="line">	</span><br><span class="line">INSERT INTO EMP(</span><br><span class="line">	EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO</span><br><span class="line">)</span><br><span class="line">VALUES</span><br><span class="line">	(7369, &#x27;SMITH&#x27;, &#x27;CLERK&#x27;, 7902, &#x27;1990-12-17&#x27;, 13750, NULL, 20),</span><br><span class="line">    (7499, &#x27;ALLEN&#x27;, &#x27;SALESMAN&#x27;, 7698, &#x27;1989-02-20&#x27;, 19000, 6400, 30),</span><br><span class="line">    (7521, &#x27;WARD&#x27;, &#x27;SALESMAN&#x27;, 7698, &#x27;1993-02-22&#x27;, 18500, 4250, 30),</span><br><span class="line">    (7566, &#x27;JONES&#x27;, &#x27;MANAGER&#x27;, 7839, &#x27;1889-04-02&#x27;, 26850, NULL, 20),</span><br><span class="line">    (7654, &#x27;MARTIN&#x27;, &#x27;SALESMAN&#x27;, 7698, &#x27;1997-09-28&#x27;, 15675, 3500, 30),</span><br><span class="line">    (7698, &#x27;BLAKE&#x27;, &#x27;MANAGER&#x27;, 7839, &#x27;1990-05-01&#x27;, 24000, NULL, 30),</span><br><span class="line">    (7782, &#x27;CLARK&#x27;, &#x27;MANAGER&#x27;, 7839, &#x27;1988-06-09&#x27;, 27500, NULL, 10),</span><br><span class="line">    (7788, &#x27;SCOTT&#x27;, &#x27;ANALYST&#x27;, 7566, &#x27;1987-04-19&#x27;, 19500, NULL, 20),</span><br><span class="line">    (7839, &#x27;KING&#x27;, &#x27;PRESIDENT&#x27;, NULL, &#x27;1983-11-17&#x27;, 82500, NULL, 10),</span><br><span class="line">    (7844, &#x27;TURNER&#x27;, &#x27;SALESMAN&#x27;, 7698, &#x27;1992-09-08&#x27;, 18500, 6250, 30),</span><br><span class="line">    (7876, &#x27;ADAMS&#x27;, &#x27;CLERK&#x27;, 7788, &#x27;1996-5-23&#x27;, 11900, NULL, 20),</span><br><span class="line">    (7900, &#x27;JAMES&#x27;, &#x27;CLERK&#x27;, 7698, &#x27;1995-12-03&#x27;, 12500, NULL, 30),</span><br><span class="line">    (7902, &#x27;FORD&#x27;, &#x27;ANALYST&#x27;, 7566, &#x27;1991-12-03&#x27;, 21500, NULL, 20),</span><br><span class="line">    (7934, &#x27;MILLER&#x27;, &#x27;CLERK&#x27;, 7782, &#x27;1995-06-23&#x27;, 13250, NULL, 10),</span><br><span class="line">    (3258, &#x27;GREEN&#x27;, &#x27;SALESMAN&#x27;, 4422, &#x27;1995-07-24&#x27;, 18500, 2750, 50),</span><br><span class="line">    (4422, &#x27;STEVENS&#x27;, &#x27;MANAGER&#x27;, 7839, &#x27;1994-06-14&#x27;, 24750, NULL, 50),</span><br><span class="line">    (6548, &#x27;BARNES&#x27;, &#x27;CLERK&#x27;, 4422, &#x27;1995-06-16&#x27;, 11950, NULL, 50);</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.beihaihaihai.top">BE1ha1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.beihaihaihai.top/2024/10/14/mySQL/">https://www.beihaihaihai.top/2024/10/14/mySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.beihaihaihai.top" target="_blank">北海の小站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></div><div class="post_share"><div class="social-share" data-image="https://my-own-pic-bed.pages.dev/img/10.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/10/04/DASDCTF-7-20/" title="DASCTF 7.20 -DosSnake"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://my-own-pic-bed.pages.dev/img/10.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">DASCTF 7.20 -DosSnake</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/xiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">BE1ha1</div><div class="author-info__description">这里是幻想乡~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/beihaihaihai"><i class="fab fa-github"></i><span>由此进入幻想乡</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/beihaihaihai" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:283829027@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">弓马齐射洒热血，突破重围显英豪！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mySQL"><span class="toc-text">安装mySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mySQL"><span class="toc-text">mySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%AF%AD%E5%8F%A5"><span class="toc-text">选择语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#select"><span class="toc-text">select</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#where"><span class="toc-text">where</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-text">逻辑运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IN%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">IN运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#between%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">between运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LIKE%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">LIKE运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#regexp%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">regexp运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IS-NULL%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">IS NULL运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#order-by"><span class="toc-text">order by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit"><span class="toc-text">limit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-text">连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#INNER-JOIN"><span class="toc-text">INNER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E8%BD%AC%E5%8C%96"><span class="toc-text">隐式转化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-text">跨数据库连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-text">自连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-text">多表连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-text">复合连接条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E8%BF%9E%E6%8E%A5"><span class="toc-text">隐式连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">多表外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">自外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#using%E5%AD%90%E5%8F%A5"><span class="toc-text">using子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="toc-text">自然连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5"><span class="toc-text">交叉连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88"><span class="toc-text">联合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-text">修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%8D%95%E8%A1%8C"><span class="toc-text">插入单行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%A4%9A%E8%A1%8C"><span class="toc-text">插入多行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%88%86%E5%B1%82%E8%A1%8C"><span class="toc-text">插入分层行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%A4%8D%E5%88%B6"><span class="toc-text">创建表复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8D%95%E8%A1%8C"><span class="toc-text">更新单行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%A4%9A%E8%A1%8C"><span class="toc-text">更新多行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E6%9B%B4%E6%96%B0%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">在更新中使用子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%8C"><span class="toc-text">删除行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">恢复数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GROUP-BY%E5%AD%90%E5%8F%A5"><span class="toc-text">GROUP BY子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HAVING%E5%AD%90%E5%8F%A5"><span class="toc-text">HAVING子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#with-rollup"><span class="toc-text">with rollup</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-text">编写复杂查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ALL%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-text">ALL关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ANY%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-text">ANY关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">相关子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXISTS%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-text">EXISTS关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#select%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">select子句中的子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#from%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">from子句中的子查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-text">其他函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-text">数值函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-text">时间函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-text">格式化日期函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4"><span class="toc-text">计算日期和时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IFNULL-COALESCE"><span class="toc-text">IFNULL COALESCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IF%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">IF表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">case运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-text">删除修改视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-text">更改视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-text">可更新视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#with-check-option"><span class="toc-text">with check option</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8"><span class="toc-text">存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">创建一个存储过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8mysql-workbench%E7%9B%B4%E6%8E%A5%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8"><span class="toc-text">在mysql workbench直接创建存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8"><span class="toc-text">删除存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E4%BC%A0%E5%8F%82%E7%9A%84%E5%AD%98%E5%82%A8"><span class="toc-text">有传参的存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E9%BB%98%E8%AE%A4%E5%80%BC%E7%9A%84%E4%BC%A0%E5%8F%82"><span class="toc-text">带默认值的传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81"><span class="toc-text">参数验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0%EF%BC%88%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%89"><span class="toc-text">输出参数（返回值）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-text">变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-text">函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">新建触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">查看触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">删除触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E8%A7%A6%E5%8F%91%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%AE%A1%E8%AE%A1"><span class="toc-text">用触发器进行审计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6event"><span class="toc-text">事件event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BA%8B%E4%BB%B6"><span class="toc-text">查看事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-text">修改事件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%EF%BC%88%E6%90%81%E7%BD%AE%EF%BC%89"><span class="toc-text">事务（搁置）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BA%8B%E5%8A%A1"><span class="toc-text">创建事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81%E5%AE%9A%E5%92%8C%E5%B9%B6%E5%8F%91"><span class="toc-text">锁定和并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98"><span class="toc-text">并发问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-text">字符串类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text">整数类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text">定点数类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0"><span class="toc-text">浮点数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B"><span class="toc-text">布尔类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-text">枚举类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-text">日期和时间类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Blob%E7%B1%BB%E5%9E%8B"><span class="toc-text">Blob类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON%E7%B1%BB%E5%9E%8B"><span class="toc-text">JSON类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">设计数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F"><span class="toc-text">第一范式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F"><span class="toc-text">第二范式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="toc-text">第三范式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">更改数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%85%B7%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="toc-text">添加具体数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="toc-text">全文索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E5%88%97%E9%A1%BA%E5%BA%8F"><span class="toc-text">复合索引中的列顺序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%AC%94%E8%AE%B0"><span class="toc-text">实验笔记</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By BE1ha1</div><div class="footer_custom_text">May all the beauty be blessed</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="/js/tw_cn.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 380px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 320px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(/img/xiang2.png);"> <a class="categoryBar-list-link" href="categories/C/">C++</a><span class="categoryBar-list-count">9</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(/img/ao3.png);"> <a class="categoryBar-list-link" href="categories/Re-wp/">Re-wp</a><span class="categoryBar-list-count">9</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(/img/umi11.png);"> <a class="categoryBar-list-link" href="categories/数据结构/">数据结构</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(/img/yuanshen1.jpg);"> <a class="categoryBar-list-link" href="categories/刷题/">刷题</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(/img/arti1.jpg);"> <a class="categoryBar-list-link" href="categories/math/">math</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><!-- hexo injector body_end end --></body></html>